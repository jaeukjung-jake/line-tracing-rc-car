# ВѓгВџЕьЋа вфевЊѕ ьЈ┤вЇћ ВЮ┤вдё
MODULES := UART BlinkedLED RingBuffer SWUART CPP

# .PHONY ВъљвЈЎ ВаЋВЮў
.PHONY: all clean flash $(MODULES) $(addsuffix -flash, $(MODULES))

# ЖИ░в│И ьЃђЖ▓Ъ: ВЋѕвѓ┤вДї ьЉюВІю
all:
	@echo "­ЪњА ВѓгВџЕв▓Ћ:"
	@echo "  make [вфевЊѕвфЁ]             Рєњ ьЋ┤вІ╣ вфевЊѕ в╣ївЊю"
	@echo "  make [вфевЊѕвфЁ]-flash       Рєњ ьЋ┤вІ╣ вфевЊѕ flash"
	@echo "  make clean                Рєњ ВаёВ▓┤ clean"
	@echo ""
	@echo "Ж░ђвіЦьЋю вфевЊѕ: $(MODULES)"

# Ж░юв│ё вфевЊѕ в╣ївЊю (Вўѕ: make UART)
$(MODULES):
	@echo "­Ъће Building $@..."
	$(MAKE) -C $@

# Ж░юв│ё вфевЊѕ flash (Вўѕ: make UART-flash)
$(foreach mod,$(MODULES),$(eval $(mod)-flash: ; \
	@echo "РџА Flashing $(mod)..."; \
	$(MAKE) -C $(mod) flash))

# ВаёВ▓┤ clean
clean:
	@for dir in $(MODULES); do \
		if [ -f $$dir/Makefile ]; then \
			echo "­ЪД╣ Cleaning $$dir..."; \
			$(MAKE) -C $$dir clean; \
		fi \
	done
